"use strict";(self.webpackChunk_1000goals_frontend=self.webpackChunk_1000goals_frontend||[]).push([[902],{4902:(M,_,s)=>{s.r(_),s.d(_,{LoginComponent:()=>D});var p=s(4755),m=s(7124),d=s(2980),c=s(1354),o=s(5030),u=s(8386),g=s(8746),l=s(3349),t=s(1902),h=s(774),v=s(7502),f=s(4120),E=s(3071);let D=(()=>{class i{constructor(r,e,n,L,S,O,T){this.fb=r,this.router=e,this.toastrService=n,this.loginService=L,this.userService=S,this.storage=O,this.userStorageKey=T,this.disabledLogin=!1,this.passwordFromQueryString="",this.usernameFromQueryString=""}ngOnInit(){this.initForm()}initForm(){const r=this.passwordFromQueryString?this.passwordFromQueryString:"";this.form=this.fb.group({name:this.fb.control(this.usernameFromQueryString?this.usernameFromQueryString:"",[o.kI.required]),password:this.fb.control(r,[o.kI.required])})}onClickLogin(){if(!this.disabledLogin){if(Object.values(this.form.controls).forEach(r=>{r.markAsTouched(),r.markAsDirty(),r.updateValueAndValidity()}),!this.nameControl?.valid||!this.passwordControl?.valid)return this.toastrService.setToastrType("error"),this.toastrService.setToastrMessage("Missing credentials, provide email and password"),void this.toastrService.setSowToastr(!0);this.disabledLogin=!0,this.loginService.login({name:this.nameControl?.value,password:this.passwordControl?.value}).pipe((0,g.x)(()=>{this.userService.getUserData()&&setTimeout(()=>{this.disabledLogin=!1,this.router.navigate(["/"+u.Z.user.base])},1e3)})).subscribe(r=>{const e=r.headers.get("Authorization");if(!e)return this.toastrService.setToastrType("error"),this.toastrService.setToastrMessage("Error while logging in"),void this.toastrService.setSowToastr(!0);this.loginService.sessionToken=e,r.body&&(this.userService.setUserData(r.body.data),this.userService.setLoginStatus(!0),(i=>{try{return JSON.stringify(i)}catch{return null}})(r.body.data)&&this.storage.setItem(this.userStorageKey,JSON.stringify(r.body.data)))})}}onClickBack(){this.router.navigateByUrl(u.Z.home.base)}get nameControl(){return this.form.get("name")}get passwordControl(){return this.form.get("password")}}return i.\u0275fac=function(r){return new(r||i)(t.Y36(o.qu),t.Y36(h.F0),t.Y36(v._),t.Y36(f.r),t.Y36(E.K),t.Y36(l.P_),t.Y36(l.H2))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-login"]],inputs:{passwordFromQueryString:["password","passwordFromQueryString"],usernameFromQueryString:["username","usernameFromQueryString"]},standalone:!0,features:[t.jDz],decls:9,vars:2,consts:[["title","Login",3,"formGroup"],[1,"inputs-area"],["id","name-id","label","Name","formControlName","name"],["id","password-id","label","Password","formControlName","password","type","password"],[1,"buttons-area"],[3,"click"],["aria-label","login",3,"disabled","click"]],template:function(r,e){1&r&&(t.TgZ(0,"app-form",0)(1,"div",1),t._UZ(2,"app-input-text",2)(3,"app-input-text",3),t.qZA(),t.TgZ(4,"div",4)(5,"app-button",5),t.NdJ("click",function(){return e.onClickBack()}),t._uU(6,"Back"),t.qZA(),t.TgZ(7,"app-button",6),t.NdJ("click",function(){return e.onClickLogin()}),t._uU(8,"Login"),t.qZA()()()),2&r&&(t.Q6J("formGroup",e.form),t.xp6(7),t.Q6J("disabled",e.disabledLogin))},dependencies:[p.ez,m.U,d.m,c.r,o.UX,o.JJ,o.JL,o.sg,o.u]}),i})()}}]);