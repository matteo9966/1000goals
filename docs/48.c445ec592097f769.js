"use strict";(self.webpackChunk_1000goals_frontend=self.webpackChunk_1000goals_frontend||[]).push([[48],{2048:(U,l,t)=>{t.r(l),t.d(l,{NewGameComponent:()=>a});var e=t(1902),h=t(4755),p=t(7408),_=t(2980),n=t(5030),g=t(1354),v=t(1397),E=t(3071),m=t(774),d=t(8386),o=t(8746);let a=(()=>{class r{createForm(){this.form=this.fb.group({name:this.fb.control("",[n.kI.required]),description:this.fb.control("",[])})}constructor(){this.fb=(0,e.f3M)(n.qu),this.gameService=(0,e.f3M)(v.h),this.userService=(0,e.f3M)(E.K),this.router=(0,e.f3M)(m.F0),this.disabledSubmit=!1,this.createForm()}get nameControl(){return this.form.get("name")}get descriptionControl(){return this.form.get("description")}get nameErrorLabel(){let i="";return this.nameControl?.errors?.required&&(i="Game name is required"),i}onSubmit(i){if(i.preventDefault(),Object.values(this.form.controls).forEach(c=>{c.markAllAsTouched(),c.updateValueAndValidity()}),this.form.invalid)return;this.disabledSubmit=!0;const u=this.nameControl?.value;this.gameService.createGame({description:this.descriptionControl?.value||"",name:u}).pipe((0,o.x)(()=>{this.disabledSubmit=!1})).subscribe(c=>{c?.data&&(this.userService.setUserData(c.data),this.router.navigateByUrl("/"+[d.Z.user.base,d.Z.user.dashboard].join("/")))})}}return r.\u0275fac=function(i){return new(i||r)},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-new-game"]],standalone:!0,features:[e.jDz],decls:10,vars:3,consts:[[1,"new-game"],[1,"title"],[1,"form",3,"formGroup"],["label","Name","id","name","formControlName","name",3,"errorLabel"],["label","Description","id","description","formControlName","description"],[1,"button-area"],["type","submit",3,"disabled","click"],[1,"button-text"]],template:function(i,u){1&i&&(e.TgZ(0,"div",0)(1,"p",1),e._uU(2,"Create a new 1000 points game"),e.qZA(),e.TgZ(3,"form",2),e._UZ(4,"app-input-text",3)(5,"app-text-area",4),e.TgZ(6,"div",5)(7,"app-button",6),e.NdJ("click",function(c){return u.onSubmit(c)}),e.TgZ(8,"span",7),e._uU(9,"Create game"),e.qZA()()()()()),2&i&&(e.xp6(3),e.Q6J("formGroup",u.form),e.xp6(1),e.Q6J("errorLabel",u.nameErrorLabel),e.xp6(3),e.Q6J("disabled",u.disabledSubmit))},dependencies:[h.ez,p.U,_.m,n.UX,n._Y,n.JJ,n.JL,n.sg,n.u,g.r],styles:[".form[_ngcontent-%COMP%]{padding-top:5rem;display:flex;flex-direction:column;gap:5rem}.title[_ngcontent-%COMP%]{font-size:3rem}.button-area[_ngcontent-%COMP%]{display:flex;justify-content:center}.button-text[_ngcontent-%COMP%]{white-space:nowrap}"],changeDetection:0}),r})()},1397:(U,l,t)=>{t.d(l,{h:()=>E});var e=t(4140),h=t(3349),p=t(515),_=t(1902),n=t(3071),g=t(3144),v=t(7502);let E=(()=>{class m{constructor(o,a,r,s){this.userService=o,this.http=a,this.toastrService=r,this.apiBase=s,this.createGameURL="",this.insertUserURL="",this.insertProposedGoalURL="",this.upvoteProposedGoalURL="",this.createGameURL=s+e.Z.games.base+e.Z.games.insertGame,this.insertUserURL=s+e.Z.games.base+e.Z.games.insertUser,this.insertProposedGoalURL=s+e.Z.games.base+e.Z.games.insertProposedGoals,this.upvoteProposedGoalURL=s+e.Z.games.base+e.Z.games.upvoteGoal}createGame(o){const r=this.userService.getUserData()?.user?.name;if(console.log(r),!r)return this.toastrService.setToastrType("error"),this.toastrService.setToastrMessage("User is not logged in"),this.toastrService.setSowToastr(!0),p.E;const s={game:{description:o.description,name:o.name},username:r};return console.log({requestBody:s}),this.http.post(this.createGameURL,s).pipe()}addUserToGame(o){const a=this.userService.getUserData()?.user?.name,r=this.userService.getUserData()?.game?.id;return a&&r?this.http.patch(this.insertUserURL,{username:o,adminId:a,gameId:r}):(this.toastrService.setToastrType("error"),this.toastrService.setToastrMessage("Error while inserting the user"),this.toastrService.setSowToastr(!0),p.E)}addProposedGoalToGame(o){if(!o)return;const a=this.userService.getUserData()?.game?.id,r=this.userService.getUserData()?.user.name;return a&&r?this.http.patch(this.insertProposedGoalURL,{gameId:a,goals:[o],username:r}):void 0}upvoteProposedGoal(o){const a=this.userService.getUserData()?.game?.id,r=this.userService.getUserData()?.user.name;if(a&&r)return this.http.patch(this.upvoteProposedGoalURL,{gameId:a,goalId:o,username:r})}}return m.\u0275fac=function(o){return new(o||m)(_.LFG(n.K),_.LFG(g.eN),_.LFG(v._),_.LFG(h.Sg))},m.\u0275prov=_.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})()}}]);